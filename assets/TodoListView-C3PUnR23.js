import{u as A,r as f,h as j,i as $,c as d,a as e,d as P,e as S,j as u,w as D,v as E,n as p,F as I,k as V,t as m,l as B,f as F,o as h,b as _}from"./index-DRrt69UI.js";const M={id:"todoListPage",class:"bg-half"},R=e("h1",null,[e("a",{href:"#"},"ONLINE TODO LIST")],-1),J={class:"conatiner todoListPage vhContainer"},U={class:"todoList_Content"},q={class:"inputBox"},H=e("i",{class:"fa fa-plus"},null,-1),G=[H],K={key:0},Q={key:1,class:"todoList_list"},W={class:"todoList_tab"},X={class:"todoList_items"},Y={class:"todoList_item"},Z={class:"todoList_label"},ee=["onClick","checked"],te=["onClick"],se=e("i",{class:"fa-solid fa-pen-to-square"},null,-1),oe=[se],ne=["onClick"],ae=e("i",{class:"fa fa-times"},null,-1),le=[ae],ie={class:"todoList_statistics"},re={key:0},de={__name:"TodoListView",setup(ce){const r="https://todolist-api.hexschool.io",g=A(),c=document.cookie.replace(/(?:(?:^|.*;\s*)authTokenCookie\s*\=\s*([^;]*).*$)|^.*$/,"$1"),k=document.cookie.replace(/(?:(?:^|.*;\s*)authNickname\s*\=\s*([^;]*).*$)|^.*$/,"$1");let i=f(!1);j(async()=>{try{(await fetch(`${r}/users/checkout`,{headers:{Authorization:c}})).ok?(alert(`哈囉 ${k}! 開始使用你的代辦清單吧~ `),y()):(alert("已登出或無權使用"),g.push("/login"))}catch(s){console.log(s.message)}});const w=async()=>{try{(await fetch(`${r}/users/sign_out`,{method:"POST",headers:{Authorization:c}})).ok?(alert("登出成功"),g.push("/login")):alert("登出失敗")}catch(s){console.log(s.message)}},a=f([]),v=f(""),y=async()=>{try{const t=await(await fetch(`${r}/todos`,{headers:{Authorization:c}})).json();a.value=t.data}catch(s){console.log(s.message)}},T=async()=>{const s=v.value.trim();if(!s){alert("欄位不可空白");return}i.value=!0;try{const t=await fetch(`${r}/todos`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:c},body:JSON.stringify({content:s})});if(t.ok){const o=(await t.json()).newTodo;a.value.push(o),v.value="",alert("新增成功"),l.value="all"}else alert("新增失敗")}catch(t){console.log(t.message)}finally{i.value=!1}},L=async(s,t)=>{const n=prompt("請輸入修改內容文字:");if(n===null){alert("取消編輯");return}if(n===""){alert("內容不可空白");return}i.value=!0;try{(await fetch(`${r}/todos/${s}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:c},body:JSON.stringify({content:n})})).ok?(a.value[t].content=n,alert("更新成功")):alert("更新失敗")}catch(o){console.log(o.message)}finally{i.value=!1}},b=async s=>{i.value=!0;try{const t=await fetch(`${r}/todos/${s}`,{method:"DELETE",headers:{Authorization:c}}),n=await t.json();t.ok&&(a.value=a.value.filter(o=>o.id!==s)),alert(n.message)}catch(t){console.log(t.message)}finally{i.value=!1}},N=async s=>{try{const t=await fetch(`${r}/todos/${s}/toggle`,{method:"PATCH",headers:{Authorization:c}}),n=await t.json();t.ok?(alert(n.message),y()):alert(n.message)}catch(t){console.log(t.message)}},O=$(()=>a.value.filter(s=>s.status===!1).length),l=f("all"),x=$(()=>l.value==="finish"?a.value.filter(s=>s.status===!0):l.value==="unfinish"?a.value.filter(s=>s.status===!1):a.value);return(s,t)=>{const n=F("RouterLink");return h(),d("div",M,[e("nav",null,[R,e("ul",null,[e("li",null,[P(n,{to:"/todo"},{default:S(()=>[e("span",null,m(_(k))+"的代辦",1)]),_:1})]),e("li",null,[e("a",{onClickOnce:u(w,["prevent"])},"登出",32)])])]),e("div",J,[e("div",U,[e("div",q,[D(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>v.value=o),type:"text",placeholder:"請輸入待辦事項"},null,512),[[E,v.value]]),e("a",{onClick:t[1]||(t[1]=u(o=>_(i)?null:T(),["prevent"]))},G)]),a.value.length===0?(h(),d("div",K,"目前尚無待辦事項")):(h(),d("div",Q,[e("ul",W,[e("li",null,[e("a",{href:"#",class:p({active:l.value==="all"}),onClick:t[2]||(t[2]=u(o=>l.value="all",["prevent"]))},"全部",2)]),e("li",null,[e("a",{href:"#",class:p({active:l.value==="unfinish"}),onClick:t[3]||(t[3]=u(o=>l.value="unfinish",["prevent"]))},"待完成",2)]),e("li",null,[e("a",{href:"#",class:p({active:l.value==="finish"}),onClick:t[4]||(t[4]=u(o=>l.value="finish",["prevent"]))},"已完成",2)])]),e("div",X,[e("ul",Y,[(h(!0),d(I,null,V(x.value,(o,z)=>(h(),d("li",{key:o.id},[e("label",Z,[e("input",{class:"todoList_input",type:"checkbox",onClick:C=>N(o.id),checked:o.status},null,8,ee),e("span",null,m(o.content),1)]),e("a",{onClick:u(C=>_(i)?null:L(o.id,z),["prevent"])},oe,8,te),e("a",{onClick:u(C=>_(i)?null:b(o.id),["prevent"])},le,8,ne)]))),128))]),e("div",ie,[l.value==="all"?(h(),d("p",re,m(O.value)+"個待完成項目",1)):B("",!0)])])]))])])])}}};export{de as default};
