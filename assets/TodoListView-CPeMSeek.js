import{u as O,r as v,g as j,h as $,c as u,a as e,b as P,d as S,i as d,j as f,w as D,v as E,n as p,F as I,k as V,t as m,l as B,e as F,o as h}from"./index-B14GhnoA.js";const M={id:"todoListPage",class:"bg-half"},R=e("h1",null,[e("a",{href:"#"},"ONLINE TODO LIST")],-1),J=["disabled"],U={class:"conatiner todoListPage vhContainer"},q={class:"todoList_Content"},H={class:"inputBox"},G=["disabled"],K=e("i",{class:"fa fa-plus"},null,-1),Q=[K],W={key:0},X={key:1,class:"todoList_list"},Y={class:"todoList_tab"},Z={class:"todoList_items"},ee={class:"todoList_item"},te={class:"todoList_label"},se=["onClick","checked"],oe=["onClick","disabled"],ae=e("i",{class:"fa-solid fa-pen-to-square"},null,-1),ne=[ae],le=["onClick","disabled"],ie=e("i",{class:"fa fa-times"},null,-1),re=[ie],ce={class:"todoList_statistics"},de={key:0},fe={__name:"TodoListView",setup(ue){const r="https://todolist-api.hexschool.io",g=O(),c=document.cookie.replace(/(?:(?:^|.*;\s*)authTokenCookie\s*\=\s*([^;]*).*$)|^.*$/,"$1"),k=document.cookie.replace(/(?:(?:^|.*;\s*)authNickname\s*\=\s*([^;]*).*$)|^.*$/,"$1");let n=v(!1);j(async()=>{try{(await fetch(`${r}/users/checkout`,{headers:{Authorization:c}})).ok?(alert(`哈囉 ${k}! 開始使用你的代辦清單吧~ `),y()):(alert("已登出或無權使用"),g.push("/login"))}catch(s){console.log(s.message)}});const w=async()=>{n=!0;try{(await fetch(`${r}/users/sign_out`,{method:"POST",headers:{Authorization:c}})).ok?(alert("登出成功"),g.push("/login")):alert("登出失敗")}catch(s){console.log(s.message)}finally{n=!1}},l=v([]),_=v(""),y=async()=>{try{const t=await(await fetch(`${r}/todos`,{headers:{Authorization:c}})).json();l.value=t.data}catch(s){console.log(s.message)}},T=async()=>{const s=_.value.trim();if(!s){alert("欄位不可空白");return}n=!0;try{const t=await fetch(`${r}/todos`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:c},body:JSON.stringify({content:s})});if(t.ok){const o=(await t.json()).newTodo;l.value.push(o),_.value="",alert("新增成功"),i.value="all"}else alert("新增失敗")}catch(t){console.log(t.message)}finally{n=!1}},b=async(s,t)=>{const a=prompt("請輸入修改內容文字:");if(a===null){alert("取消編輯");return}if(a===""){alert("內容不可空白");return}n=!0;try{(await fetch(`${r}/todos/${s}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:c},body:JSON.stringify({content:a})})).ok?(l.value[t].content=a,alert("更新成功")):alert("更新失敗")}catch(o){console.log(o.message)}finally{n=!1}},L=async s=>{n=!0;try{const t=await fetch(`${r}/todos/${s}`,{method:"DELETE",headers:{Authorization:c}}),a=await t.json();t.ok&&(l.value=l.value.filter(o=>o.id!==s)),alert(a.message)}catch(t){console.log(t.message)}finally{n=!1}},N=async s=>{try{const t=await fetch(`${r}/todos/${s}/toggle`,{method:"PATCH",headers:{Authorization:c}}),a=await t.json();t.ok?(alert(a.message),y()):alert(a.message)}catch(t){console.log(t.message)}},x=$(()=>l.value.filter(s=>s.status===!1).length),i=v("all"),z=$(()=>i.value==="finish"?l.value.filter(s=>s.status===!0):i.value==="unfinish"?l.value.filter(s=>s.status===!1):l.value);return(s,t)=>{const a=F("RouterLink");return h(),u("div",M,[e("nav",null,[R,e("ul",null,[e("li",null,[P(a,{to:"/todo"},{default:S(()=>[e("span",null,m(f(k))+"的代辦",1)]),_:1})]),e("li",null,[e("a",{href:"#",onClick:d(w,["prevent"]),disabled:f(n)},"登出",8,J)])])]),e("div",U,[e("div",q,[e("div",H,[D(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>_.value=o),type:"text",placeholder:"請輸入待辦事項"},null,512),[[E,_.value]]),e("a",{onClick:d(T,["prevent"]),href:"#",disabled:f(n)},Q,8,G)]),l.value.length===0?(h(),u("div",W,"目前尚無待辦事項")):(h(),u("div",X,[e("ul",Y,[e("li",null,[e("a",{href:"#",class:p({active:i.value==="all"}),onClick:t[1]||(t[1]=d(o=>i.value="all",["prevent"]))},"全部",2)]),e("li",null,[e("a",{href:"#",class:p({active:i.value==="unfinish"}),onClick:t[2]||(t[2]=d(o=>i.value="unfinish",["prevent"]))},"待完成",2)]),e("li",null,[e("a",{href:"#",class:p({active:i.value==="finish"}),onClick:t[3]||(t[3]=d(o=>i.value="finish",["prevent"]))},"已完成",2)])]),e("div",Z,[e("ul",ee,[(h(!0),u(I,null,V(z.value,(o,A)=>(h(),u("li",{key:o.id},[e("label",te,[e("input",{class:"todoList_input",type:"checkbox",onClick:C=>N(o.id),checked:o.status},null,8,se),e("span",null,m(o.content),1)]),e("a",{onClick:d(C=>b(o.id,A),["prevent"]),href:"#",disabled:f(n)},ne,8,oe),e("a",{onClick:d(C=>L(o.id),["prevent"]),href:"#",disabled:f(n)},re,8,le)]))),128))]),e("div",ce,[i.value==="all"?(h(),u("p",de,m(x.value)+"個待完成項目",1)):B("",!0)])])]))])])])}}};export{fe as default};
